<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        #map {
            height: 100%;
            width: 80%;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        .map__wrapper {}
        .sidebar {

        }
        .marker-cluster-small {
            background-color: rgba(181, 226, 140, 0.6);
        }

        .marker-cluster-small div {
            background-color: rgba(110, 204, 57, 0.6);
        }

        .marker-cluster-medium {
            background-color: rgba(241, 211, 87, 0.6);
        }

        .marker-cluster-medium div {
            background-color: rgba(240, 194, 12, 0.6);
        }

        .marker-cluster-large {
            background-color: rgba(253, 156, 115, 0.6);
        }

        .marker-cluster-large div {
            background-color: rgba(241, 128, 23, 0.6);
        }

        .marker-cluster {
            background-clip: padding-box;
            border-radius: 20px;
        }

        .marker-cluster div {
            width: 30px;
            height: 30px;
            margin-left: 5px;
            margin-top: 5px;

            text-align: center;
            border-radius: 15px;
            font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
        }

        .marker-cluster span {
            line-height: 30px;
        }

        /*infoWindow*/
        .map__maskNum {
            height: 30px;
        }

        .leaflet-popup-content h3 {
            font-size: 20px;
            line-height: 1;
        }

        .map__maskNum div {
            float: left;
            font-size: 16px;
            margin-right: 5px;
        }

        .map__maskNum div em {
            font-style: normal;
            font-size: 13px;
        }

        .map__maskNum div:nth-of-type(1) {

        }

        .map__maskNum div:nth-of-type(2) {

        }
    </style>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.css"></link>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.Default.css"></link>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin=""/>
    <!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js"></script>-->
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
            integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
            crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js"></script>
</head>
<body>
<div class="map__wrapper">
    <div class="sidebar">

    </div>
    <div id="map"></div>
</div>
<script>
    var dataJson = {
        "type": "FeatureCollection",
        "features": [
            {
                "type": "Feature",
                "properties": {
                    "id": "5901012203",
                    "name": "博荃藥局",
                    "phone": "02 -27316736",
                    "address": "台北市松山區敦化北路4巷51號",
                    "mask_adult": 0,
                    "mask_child": 0,
                    "updated": "2020\/02\/09 14:36:40",
                    "available": "星期一上午看診、星期二上午看診、星期三上午看診、星期四上午看診、星期五上午看診、星期六上午看診、星期日上午休診、星期一下午看診、星期二下午看診、星期三下午看診、星期四下午看診、星期五下午看診、星期六下午看診、星期日下午休診、星期一晚上看診、星期二晚上看診、星期三晚上看診、星期四晚上看診、星期五晚上看診、星期六晚上看診、星期日晚上休診",
                    "note": "如遇國定連續假期,藥局公休",
                    "custom_note": "",
                    "website": ""
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        121.544742,
                        25.050063
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "id": "5901012383",
                    "name": "德川中西藥局",
                    "phone": "02 -27683399",
                    "address": "台北市松山區八德路4段96號",
                    "mask_adult": 2,
                    "mask_child": 46,
                    "updated": "2020\/02\/09 14:36:40",
                    "available": "星期一上午看診、星期二上午看診、星期三上午看診、星期四上午看診、星期五上午看診、星期六上午休診、星期日上午休診、星期一下午看診、星期二下午看診、星期三下午看診、星期四下午看診、星期五下午看診、星期六下午休診、星期日下午看診、星期一晚上看診、星期二晚上看診、星期三晚上看診、星期四晚上看診、星期五晚上看診、星期六晚上休診、星期日晚上休診",
                    "note": "",
                    "custom_note": "",
                    "website": ""
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        121.56066,
                        25.04836
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "id": "5901012409",
                    "name": "家音藥局",
                    "phone": "02 -37652080",
                    "address": "台北市松山區民生東路5段73號",
                    "mask_adult": 196,
                    "mask_child": 51,
                    "updated": "2020\/02\/09 14:36:40",
                    "available": "星期一上午看診、星期二上午看診、星期三上午看診、星期四上午看診、星期五上午看診、星期六上午看診、星期日上午看診、星期一下午看診、星期二下午看診、星期三下午看診、星期四下午看診、星期五下午看診、星期六下午看診、星期日下午看診、星期一晚上看診、星期二晚上看診、星期三晚上看診、星期四晚上看診、星期五晚上看診、星期六晚上看診、星期日晚上看診",
                    "note": "早上9:00到晚上11:00",
                    "custom_note": "",
                    "website": ""
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        121.558489,
                        25.058709
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "id": "5901012454",
                    "name": "敦北藥局",
                    "phone": "02 -27155691",
                    "address": "台北市松山區民生東路4段80巷5號",
                    "mask_adult": 0,
                    "mask_child": 6,
                    "updated": "2020\/02\/09 14:36:40",
                    "available": "星期一上午看診、星期二上午看診、星期三上午看診、星期四上午看診、星期五上午看診、星期六上午看診、星期日上午看診、星期一下午看診、星期二下午看診、星期三下午看診、星期四下午看診、星期五下午看診、星期六下午看診、星期日下午看診、星期一晚上看診、星期二晚上看診、星期三晚上看診、星期四晚上看診、星期五晚上看診、星期六晚上看診、星期日晚上看診",
                    "note": "",
                    "custom_note": "",
                    "website": ""
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        121.553125,
                        25.057129
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "id": "5901012490",
                    "name": "中美藥局",
                    "phone": "02 -27627468",
                    "address": "台北市松山區富錦街531號",
                    "mask_adult": 0,
                    "mask_child": 13,
                    "updated": "2020\/02\/09 14:36:40",
                    "available": "星期一上午看診、星期二上午看診、星期三上午看診、星期四上午看診、星期五上午看診、星期六上午看診、星期日上午看診、星期一下午看診、星期二下午看診、星期三下午看診、星期四下午看診、星期五下午看診、星期六下午看診、星期日下午看診、星期一晚上看診、星期二晚上看診、星期三晚上看診、星期四晚上看診、星期五晚上看診、星期六晚上看診、星期日晚上看診",
                    "note": "營業時間如有異動,以藥局公告為準",
                    "custom_note": "",
                    "website": ""
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        121.565481,
                        25.061285
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "id": "5901012507",
                    "name": "康麗藥局",
                    "phone": "02 -27174117",
                    "address": "台北市松山區南京東路3段303巷20號",
                    "mask_adult": 0,
                    "mask_child": 6,
                    "updated": "2020\/02\/09 14:36:40",
                    "available": "星期一上午看診、星期二上午看診、星期三上午看診、星期四上午看診、星期五上午看診、星期六上午看診、星期日上午休診、星期一下午看診、星期二下午看診、星期三下午看診、星期四下午看診、星期五下午看診、星期六下午看診、星期日下午休診、星期一晚上看診、星期二晚上看診、星期三晚上看診、星期四晚上看診、星期五晚上看診、星期六晚上看診、星期日晚上休診",
                    "note": "春節營業時間請電洽",
                    "custom_note": "",
                    "website": ""
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        121.546826,
                        25.05369
                    ]
                }
            }
        ]
    };
    var data = dataJson.features;
    var map = L.map('map', {
        center: [25.053144, 121.544704],
        zoom: 16
    });

    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 20,
        id: 'mapbox/streets-v11',
        accessToken: 'pk.eyJ1Ijoiam9objg4OTUiLCJhIjoiY2s2ZjBpbnRlMDQxNTNlbXQzcGRmd3g0ZSJ9.CZhZ2p1dMuFgIPard8rqwg'
    }).addTo(map);

    var greenIcon = new L.Icon({
        iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    });
    var blueIcon = new L.Icon({
        iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    });
    var greyIcon = new L.Icon({
        iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-grey.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    });

    // L.marker([25.061285, 121.565481], {icon: greenIcon}).addTo(map)
    //     .bindPopup('<h1>測試藥局</h1><p>成人口罩：50<br>兒童口罩：50</p>');
    //
    // L.marker([25.050063, 121.544742]).addTo(map)
    //     .bindPopup('<h1>測試藥局</h1><p>成人口罩：50<br>兒童口罩：50</p>');
    //
    // L.marker([25.04836, 121.56066]).addTo(map)
    //     .bindPopup('<h1>測試藥局</h1><p>成人口罩：50<br>兒童口罩：50</p>');

    var markers = new L.MarkerClusterGroup().addTo(map);


    // var xhr = new XMLHttpRequest();
    // xhr.open("get","https://raw.githubusercontent.com/kiang/pharmacies/master/json/points.json");
    // xhr.send();
    // xhr.onload = function () {
    //     var data = JSON.parse(xhr.responseText).features;
    //     for(let i=0;i<data.length;i++){
    //
    //     }
    // }

    for (let i = 0; i < data.length; i++) {
        var lat = data[i].geometry.coordinates[1];
        var lng = data[i].geometry.coordinates[0];
        var info = data[i].properties;
        // 如果口罩數量為0，則不顯示
        if (info.mask_adult + info.mask_child === 0) {
            continue;
        }
        // info.phone
        // info.address
        // info.mask_adult
        // info.mask_child
        // info.updated
        // info.available
        // info.note
        //
        // map原生資訊
        // 與目前位置距離
        // 目前地址
        //
        // 地圖
        //     判斷：
        //     有口罩：綠色、沒口罩：灰色
        //     當前位置：紅色圖示、店家點（綠色）
        // infoWindow
        // 店名、距離當前幾km
        // 更新時間 ----OK
        // 口罩數量：成人 0、兒童 20 -----OK
        // 導航連結
        // *標星號
        // 側邊欄
        //     今天日期
        //     顯示字串：最後一碼…
        //     當前位置：顯示地址
        //     輸入地址 查詢
        //     列表項目
        //         店名、距離當前幾km
        //         地址
        //         電話（點選可撥打）
        //         營業時間
        //         口罩數量：成人 0 、兒童 20
        //         *標星號
        //         *導航連結
        //     篩選
        //         所有口罩：預設顯示
        //         成人口罩：顯示成人口罩數量不等於 0 的店家
        //         兒童口罩：顯示兒童口罩數量不等於 0 的店家
        //         距離最近：離當前位置最近：取得一定範圍內所有marker，計算與當前位置之間的差距，取最小
        //         存量最多：計算一定範圍內所有marker，口罩總數（成人+兒童）最多，取最大
        //         *已標星號
        //
        //判斷
        /*
        * 所有口罩、成人、兒童
        * 店家名稱、地址、電話
        *
        *
        * */
        markers.addLayer(L.marker([lat, lng], {icon: info.mask_adult + info.mask_child !== 0 ? blueIcon : greyIcon})
            .bindPopup("<h1>" + info.name + "</h1><em>" + info.updated + " 更新</em><div class='map__maskNum'><div><em>成人</em> " + info.mask_adult + "</div><div><em>兒童</em> " + info.mask_child + "</div></div>"));
    }
    map.addLayer(markers);
</script>

</body>
</html>